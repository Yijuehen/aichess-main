# æ•°æ®æ”¶é›†è„šæœ¬ä½¿ç”¨æŒ‡å—

## ğŸ“ è„šæœ¬æ–‡ä»¶è¯´æ˜

### ä¸»è¦è„šæœ¬
- **run_parallel_collect.sh** - å¤šGPUå¹¶è¡Œæ•°æ®æ”¶é›†ï¼ˆæ™ºèƒ½GPUæ£€æµ‹ï¼‰
- **run_distributed_train.sh** - å¤šGPUåˆ†å¸ƒå¼è®­ç»ƒ

### è¾…åŠ©è„šæœ¬
- **start_collect.sh** - å¿«é€Ÿå¯åŠ¨collect
- **stop_collect.sh** - åœæ­¢collect
- **monitor.sh** - å®æ—¶ç›‘æ§collectçŠ¶æ€
- **export_redis_data.sh** - å¯¼å‡ºRedisæ•°æ®åˆ°æ–‡ä»¶
- **import_redis_data.sh** - ä»æ–‡ä»¶å¯¼å…¥æ•°æ®åˆ°Redis

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨æ•°æ®æ”¶é›†

```bash
cd /tmp/aichess-main
./start_collect.sh
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
========================================
ğŸš€ å¯åŠ¨Collectæ•°æ®æ”¶é›†
========================================

âœ… Redisè¿è¡Œæ­£å¸¸

å¯åŠ¨collect...

âœ… Collectå·²å¯åŠ¨ï¼

è¿›ç¨‹ID: 12345
æ—¥å¿—æ–‡ä»¶: nohup_collect.log

å¸¸ç”¨å‘½ä»¤:
  æŸ¥çœ‹æ—¥å¿—: tail -f nohup_collect.log
  æŸ¥çœ‹è¿›åº¦: redis-cli GET iters
  ç›‘æ§çŠ¶æ€: ./monitor.sh
  åœæ­¢ç¨‹åº: ./stop_collect.sh
========================================
```

---

### 2. ç›‘æ§è¿è¡ŒçŠ¶æ€

```bash
./monitor.sh
```

**æ˜¾ç¤ºå†…å®¹**ï¼š
- âœ… è¿›ç¨‹çŠ¶æ€ï¼ˆPIDã€CPUã€å†…å­˜ï¼‰
- ğŸ“Š æ•°æ®è¿›åº¦ï¼ˆæ¸¸æˆå±€æ•°ã€è®­ç»ƒæ ·æœ¬æ•°ï¼‰
- ğŸ“ˆ è¿›åº¦æ¡ï¼ˆç›®æ ‡5000å±€ï¼‰
- ğŸ® GPUçŠ¶æ€ï¼ˆåˆ©ç”¨ç‡ã€æ˜¾å­˜ä½¿ç”¨ï¼‰
- ğŸ“ æœ€æ–°æ—¥å¿—

**æŒ‰ Ctrl+C é€€å‡ºç›‘æ§ï¼ˆä¸å½±å“collectè¿è¡Œï¼‰**

---

### 3. æŸ¥çœ‹å®æ—¶æ—¥å¿—

```bash
tail -f nohup_collect.log
```

**æŒ‰ Ctrl+C é€€å‡ºæ—¥å¿—æŸ¥çœ‹**

---

### 4. åœæ­¢æ•°æ®æ”¶é›†

```bash
./stop_collect.sh
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
========================================
ğŸ›‘ åœæ­¢Collect
========================================

åœæ­¢è¿›ç¨‹: 12345
âœ… å·²åœæ­¢

éªŒè¯:
âœ… æ‰€æœ‰è¿›ç¨‹å·²åœæ­¢

æ•°æ®çŠ¶æ€:
  å·²æ”¶é›†å±€æ•°: 28
  è®­ç»ƒæ ·æœ¬æ•°: 2520
========================================
```

---

## ğŸ“Š å¸¸ç”¨å‘½ä»¤

### æŸ¥çœ‹æ”¶é›†è¿›åº¦

```bash
# æŸ¥çœ‹æ¸¸æˆå±€æ•°
redis-cli GET iters

# æŸ¥çœ‹è®­ç»ƒæ ·æœ¬æ•°
redis-cli LLEN train_data_buffer

# æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€
ps aux | grep collect.py | grep -v grep

# æŸ¥çœ‹GPUä½¿ç”¨
nvidia-smi
```

---

### åå°è¿è¡Œ

è„šæœ¬å·²ç»ä½¿ç”¨ `nohup` åå°è¿è¡Œï¼Œå¯ä»¥å®‰å…¨é€€å‡ºSSHï¼š

```bash
# å¯åŠ¨
./start_collect.sh

# é€€å‡ºSSH
exit
# ç¨‹åºç»§ç»­è¿è¡Œï¼

# ä¸‹æ¬¡ç™»å½•æŸ¥çœ‹
ssh user@server
cd /tmp/aichess-main
./monitor.sh
```

---

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

### é˜¶æ®µ1ï¼šæ•°æ®æ”¶é›†ï¼ˆå†·å¯åŠ¨ï¼‰

```bash
# å¯åŠ¨collect
./start_collect.sh

# ç›‘æ§è¿›åº¦
./monitor.sh

# ç­‰å¾…æ”¶é›†500-1000å±€ï¼ˆå¯é€šè¿‡redis-cli GET itersæŸ¥çœ‹ï¼‰
```

### é˜¶æ®µ2ï¼šå¼€å§‹è®­ç»ƒ

è¾¾åˆ°ç›®æ ‡å±€æ•°åï¼Œåˆ‡æ¢åˆ°ä¸€æ”¶é›†ä¸€è®­ç»ƒæ¨¡å¼ï¼š

```bash
# ç»ˆç«¯1ï¼šç»§ç»­æ”¶é›†
CUDA_VISIBLE_DEVICES=0 python collect.py

# ç»ˆç«¯2ï¼šè®­ç»ƒæ¨¡å‹
CUDA_VISIBLE_DEVICES=1 python train.py
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. Rediså¿…é¡»è¿è¡Œ

å¯åŠ¨collectå‰ç¡®ä¿Redisè¿è¡Œï¼š

```bash
# æ£€æŸ¥Redis
redis-cli ping
# åº”è¯¥è¿”å›: PONG

# å¦‚æœæ²¡è¿è¡Œï¼Œå¯åŠ¨Redis
sudo systemctl start redis
```

### 2. GPUå†…å­˜è¦æ±‚

- æœ€ä½ç©ºé—²å†…å­˜ï¼š2GB
- æœ€ä½GPUåˆ©ç”¨ç‡ï¼š<90%

è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶åªä½¿ç”¨ç¬¦åˆæ¡ä»¶çš„GPUã€‚

### 3. æ•°æ®å­˜å‚¨

- âœ… æ•°æ®ä¿å­˜åœ¨Rediså†…å­˜ä¸­
- âœ… æœ€å¤§ä¿ç•™100,000ä¸ªæ ·æœ¬
- âœ… è¶…é™åè‡ªåŠ¨åˆ é™¤æ—§æ•°æ®ï¼ˆå¾ªç¯ä½¿ç”¨ï¼‰
- âœ… ä¸ä¼šçˆ†å†…å­˜

### 4. æ¨¡å‹æ–‡ä»¶

- âš ï¸ æ¨¡å‹æ–‡ä»¶è·¯å¾„ï¼š`models/current_policy100.pkl`
- âš ï¸ å¦‚æœæ¨¡å‹ä¸å­˜åœ¨ï¼Œä¼šåˆ›å»ºéšæœºåˆå§‹åŒ–çš„æ–°æ¨¡å‹
- ğŸ’¡ å»ºè®®å…ˆæ”¶é›†æ•°æ®ï¼Œå†å¼€å§‹è®­ç»ƒ

---

## ğŸ“ˆ é¢„æœŸæ€§èƒ½

| GPUæ•°é‡ | æ”¶é›†é€Ÿåº¦ | é¢„è®¡æ—¶é—´ï¼ˆ1000å±€ï¼‰ |
|---------|---------|-------------------|
| 1 GPU   | 1.0x    | ~8å°æ—¶            |
| 2 GPU   | 1.8x    | ~4.5å°æ—¶          |
| 4 GPU   | 3.5x    | ~2.5å°æ—¶          |

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šRedisè¿æ¥å¤±è´¥

```
Error: Error connecting to Redis
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
sudo systemctl start redis
redis-cli ping
```

### é—®é¢˜2ï¼šGPUå†…å­˜ä¸è¶³

```
CUDA out of memory
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å‡å°‘collectè¿›ç¨‹æ•°é‡
- æ£€æŸ¥GPUä½¿ç”¨ï¼š`nvidia-smi`

### é—®é¢˜3ï¼šè¿›ç¨‹æ„å¤–é€€å‡º

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥çœ‹æ—¥å¿—
tail -50 nohup_collect.log

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
ls -lt collect_*.log
tail -f collect_*.log
```

---

## ğŸ’¾ æ•°æ®å¯¼å‡ºä¸å¯¼å…¥

### å¯¼å‡ºRedisæ•°æ®åˆ°æ–‡ä»¶

**ä¸ºä»€ä¹ˆéœ€è¦å¯¼å‡ºï¼Ÿ**
- âœ… å¤‡ä»½é‡è¦æ•°æ®
- âœ… åœ¨å…¶ä»–æœºå™¨ä¸Šä½¿ç”¨
- âœ… é˜²æ­¢Redisé‡å¯æ•°æ®ä¸¢å¤±

#### å¯¼å‡ºå‘½ä»¤

```bash
./export_redis_data.sh
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
========================================
ğŸ’¾ å¯¼å‡ºRedisæ•°æ®åˆ°æ–‡ä»¶
========================================

ğŸ“Š å½“å‰Redisæ•°æ®çŠ¶æ€:
  æ¸¸æˆå±€æ•°: 500
  è®­ç»ƒæ ·æœ¬: 45000

ğŸ“¦ å¼€å§‹å¯¼å‡º...
  ç›®æ ‡æ–‡ä»¶: exports/train_data_backup_20260122_120000.pkl

æ€»æ ·æœ¬æ•°: 45000
å¯¼å‡ºè¿›åº¦: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 45000/45000

âœ… å¯¼å‡ºå®Œæˆï¼
æ–‡ä»¶: exports/train_data_backup_20260122_120000.pkl
æ ·æœ¬æ•°: 45000

========================================
å¯¼å‡ºå®Œæˆï¼
========================================

æ–‡ä»¶ä½ç½®: exports/train_data_backup_20260122_120000.pkl
æ–‡ä»¶å¤§å°: 500M
========================================
```

#### æŸ¥çœ‹å¯¼å‡ºçš„æ–‡ä»¶

```bash
# åˆ—å‡ºæ‰€æœ‰å¤‡ä»½æ–‡ä»¶
ls -lh exports/

# æŸ¥çœ‹æœ€æ–°å¤‡ä»½
ls -lt exports/ | head -2
```

---

### ä»æ–‡ä»¶å¯¼å…¥æ•°æ®åˆ°Redis

**ä½¿ç”¨åœºæ™¯**ï¼š
- âœ… æ¢å¤ä¹‹å‰å¯¼å‡ºçš„æ•°æ®
- âœ… ä»å…¶ä»–æœºå™¨è¿ç§»æ•°æ®
- âœ… åˆå¹¶å¤šä¸ªæ•°æ®é›†

#### å¯¼å…¥å‘½ä»¤

```bash
# æŸ¥çœ‹å¯ç”¨çš„å¤‡ä»½æ–‡ä»¶
./import_redis_data.sh

# å¯¼å…¥æŒ‡å®šæ–‡ä»¶
./import_redis_data.sh exports/train_data_backup_20260122_120000.pkl
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
========================================
ğŸ“¥ å¯¼å…¥æ•°æ®åˆ°Redis
========================================

ğŸ“„ æ–‡ä»¶ä¿¡æ¯:
  æ–‡ä»¶: exports/train_data_backup_20260122_120000.pkl
  å¤§å°: 500M

âš ï¸  æ³¨æ„ï¼šå¯¼å…¥å°†æ·»åŠ åˆ°ç°æœ‰æ•°æ®
æ˜¯å¦ç»§ç»­? (y/N): y

ğŸ“¦ å¼€å§‹å¯¼å…¥...
è¯»å–æ–‡ä»¶: exports/train_data_backup_20260122_120000.pkl
æ ·æœ¬æ•°: 45000
å½“å‰Redisæ ·æœ¬æ•°: 10000
æ­£åœ¨å¯¼å…¥æ•°æ®...
å¯¼å…¥è¿›åº¦: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 45000/45000

âœ… å¯¼å…¥å®Œæˆï¼
å¯¼å…¥æ ·æœ¬æ•°: 45000
æ›´æ–°æ¸¸æˆå±€æ•°: 100 â†’ 600

========================================
å¯¼å…¥å®Œæˆï¼
========================================

ğŸ“Š æ›´æ–°åçš„RedisçŠ¶æ€:
  æ¸¸æˆå±€æ•°: 600
  è®­ç»ƒæ ·æœ¬: 55000
========================================
```

---

### å®šæœŸå¤‡ä»½å»ºè®®

#### æ¯å¤©è‡ªåŠ¨å¤‡ä»½

```bash
# æ·»åŠ åˆ°crontab
crontab -e

# æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½
0 2 * * * cd /tmp/aichess-main && ./export_redis_data.sh >> export.log 2>&1
```

#### æ‰‹åŠ¨å®šæœŸå¤‡ä»½

```bash
# æ¯å‘¨å¤‡ä»½ä¸€æ¬¡
./export_redis_data.sh

# æˆ–è€…è¾¾åˆ°ä¸€å®šå±€æ•°åå¤‡ä»½
iters=$(redis-cli GET iters)
if [ "$iters" -gt 1000 ]; then
    ./export_redis_data.sh
fi
```

---

## ğŸ“ æ€»ç»“

| ä»»åŠ¡ | å‘½ä»¤ |
|------|------|
| **å¯åŠ¨** | `./start_collect.sh` |
| **ç›‘æ§** | `./monitor.sh` |
| **æŸ¥çœ‹æ—¥å¿—** | `tail -f nohup_collect.log` |
| **æŸ¥çœ‹è¿›åº¦** | `redis-cli GET iters` |
| **åœæ­¢** | `./stop_collect.sh` |
| **å¯¼å‡ºæ•°æ®** | `./export_redis_data.sh` |
| **å¯¼å…¥æ•°æ®** | `./import_redis_data.sh <æ–‡ä»¶å>` |

**ç®€å•ã€å¯é ã€è‡ªåŠ¨åŒ–ï¼** ğŸ¯
